<app-sidebar></app-sidebar>

<div class="issue-container">
  <div *ngIf="loading">â³ Loading issues...</div>
  <div *ngIf="error" class="error-alert">{{ error }}</div>

  <section *ngFor="let issue of issues" class="issue-problem">
    <header class="issue-header">
      <div class="issue-meta">
        <span class="issue-status" [ngClass]="{ open: issue.status === 'open' }">
          {{ issue.status | titlecase }}
        </span>
        <span class="issue-number">#{{ issue.id }}</span>
        <span class="issue-date">
          Created {{ issue.createdAt | date: 'medium' }}
        </span>
      </div>

      <h1 class="issue-title">{{ issue.title }}</h1>

      <div class="issue-author" *ngIf="issue.createdBy">
        <img
          [src]="issue.createdBy.profileImage || 'images/user.png'"
          alt="Author"
          class="avatar"
        />
        <div>
          <strong>
            {{ issue.createdBy.first_name }} {{ issue.createdBy.last_name }}
          </strong>
          <span class="author-note">opened this issue</span>
        </div>
      </div>
    </header>

    <div class="error-alert">
      <strong>ğŸ“ Description:</strong> {{ issue.description }}
    </div>

    <!-- Feedbacks -->
    <section class="solutions-section" *ngIf="issue.feedbacks?.length">
      <h2 class="solutions-title">ğŸ’¡ Feedbacks</h2>

      <article *ngFor="let feedback of issue.feedbacks" class="solution-card">
        <header class="solution-header">
          <div class="solution-author">
            <img
              [src]="feedback.user?.profileImage || 'images/user.png'"
              alt="User"
              class="avatar"
            />
            <div>
              <strong>
                {{ feedback.user?.first_name }} {{ feedback.user?.last_name }}
              </strong>
              <span class="time-ago">
                {{ feedback.createdAt | date: 'short' }}
              </span>
            </div>
          </div>
        </header>

        <p class="solution-text">{{ feedback.content || 'No content yet' }}</p>

        <div class="comments" *ngIf="feedback.comments?.length">
          <p *ngFor="let comment of feedback.comments">
            ğŸ’¬ <strong>{{ comment.user.first_name }}:</strong> {{ comment.content }}
          </p>
        </div>
      </article>
    </section>
  </section>
</div>
