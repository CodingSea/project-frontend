<div class="container">
  <app-sidebar />

  <div class="pm-container">
    <div class="service-dashbaord_33-2">
      <div class="body_33-3">
        <div class="div_33-4">
          <div class="main_33-71">
            <div class="div_33-96">
              <div class="main-div">
                <!-- üìä Stats Section -->
                <ul class="stats-list">
                  <li class="stat-item">
                    <span class="text-total-projects">Total Services</span>
                    <span class="text-24">{{ servicesInfo.totalServices }}</span>
                  </li>
                  <li class="stat-item">
                    <span class="text-active-tasks">Backlogged Tasks</span>
                    <span class="text-156">{{ servicesInfo.backloggedTasks }}</span>
                  </li>
                  <li class="stat-item">
                    <span class="text-active-tasks">Active Tasks</span>
                    <span class="text-156">{{ servicesInfo.activeTasks }}</span>
                  </li>
                  <li class="stat-item">
                    <span class="text-team-members">Team Members</span>
                    <span class="text-32">{{ servicesInfo.totalMembers }}</span>
                  </li>
                  <li class="stat-item">
                    <span class="text-completion-rate">Completion Rate</span>
                    <span class="text-87">
                      {{ servicesInfo.completionRate.toFixed(2) }}%
                    </span>
                  </li>
                </ul>
              </div>

              <!-- üßæ Recent Services Section -->
              <div class="div_33-138">
                <div class="recent-services">
                  <span class="text-recent-projects">Recent Services:</span>

                  <!-- Filter Controls -->
                  <div class="filter-container">
                    <select
                      class="select"
                      [(ngModel)]="selectedFilter"
                      (change)="applyFilters()"
                    >
                      <option value="all">All Services</option>
                      <option value="active">Active</option>
                      <option value="in-review">In Review</option>
                      <option value="urgent">Urgent</option>
                    </select>

                    <button
                      class="button"
                      type="button"
                      aria-label="Open filters"
                      (click)="openFilter()"
                    >
                      <!-- keep your filter SVG here -->
                    </button>
                  </div>

                  <!-- Filter Side Panel -->
                  <div *ngIf="showFilter">
                    <div
                      class="pm-filter-backdrop"
                      (click)="closeFilter()"
                    ></div>
                    <aside
                      class="pm-filter-panel"
                      role="dialog"
                      aria-label="Filters"
                    >
                      <div class="pm-filter-header">
                        <strong>Filters</strong>
                        <button
                          class="pm-close"
                          type="button"
                          (click)="closeFilter()"
                        >
                          √ó
                        </button>
                      </div>
                      <div class="pm-filter-body">
                        <div class="pm-row">
                          <label>
                            <input
                              type="checkbox"
                              [(ngModel)]="filterState.active"
                            />
                            Active
                          </label>
                        </div>
                        <div class="pm-row">
                          <label>
                            <input
                              type="checkbox"
                              [(ngModel)]="filterState.inReview"
                            />
                            In Review
                          </label>
                        </div>
                        <div class="pm-row">
                          <label>
                            <input
                              type="checkbox"
                              [(ngModel)]="filterState.urgent"
                            />
                            Urgent
                          </label>
                        </div>
                      </div>
                    </aside>
                  </div>
                </div>

                <!-- üß± Service Cards Section -->
                <div class="pm-cards">
                  <!-- ‚ûï Add New Service Card -->
                  <article class="pm-card add-new" (click)="openNewService()">
                    <div class="pm-plus-circle">
                      <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                        <path
                          d="M12 5v14M5 12h14"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                        />
                      </svg>
                    </div>
                    <h3>Add New Service</h3>
                    <p>Start a new service and invite your team members</p>
                  </article>

                  <!-- üîÅ Dynamic Service Cards -->
                  <article
                    class="pm-card"
                    *ngFor="let p of services"
                    (click)="onCardClick(p)"
                  >
                    <header class="pm-card-header">
                      <h3>{{ p.name }}</h3>
                      <span
                        class="pm-pill"
                        [attr.data-status]="p.status"
                        >{{ p.status }}</span
                      >

                      <!-- ‚ãÆ Card Menu -->
                      <div class="pm-card-menu" (click)="$event.stopPropagation()">
                        <button
                          class="dots"
                          type="button"
                          aria-label="Options"
                          (click)="toggleMenu(p.serviceID, $event)"
                        >
                          ‚ãÆ
                        </button>

                        <ul class="menu" *ngIf="openMenuId === p.serviceID">
                          <li (click)="goToEdit(p, $event)">Edit</li>
                          <!-- <li class="danger" (click)="confirmDelete(p, $event)">üóëÔ∏è Delete</li> -->
                        </ul>
                      </div>
                    </header>

                    <!-- Description -->
                    <p class="pm-desc">{{ p.description }}</p>

                    <p class="pm-members">Members: {{ p.memberCount }}</p>

                    <!-- Footer -->
                    <footer class="pm-card-footer">
                      <span class="pm-due">Due: {{ p.deadline | date: 'MMM d' }}</span>
                      <div class="pm-progress">
                        <div
                          class="pm-progress-fill"
                          [style.width.%]="p.completionRate?.toFixed(2)"
                        ></div>
                      </div>
                      <span class="pm-progress-label">{{ p.completionRate }}%</span>
                    </footer>
                  </article>
                </div>
                <!-- ‚úÖ End of Cards -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- üîπ New Service Popup Modal (single clean version) -->
    <div
      class="pm-modal-backdrop"
      *ngIf="showNewService"
      (click)="closeNewService()"
    ></div>

    <div
      class="pm-modal"
      *ngIf="showNewService"
      (click)="$event.stopPropagation()"
    >
      <header class="pm-modal-header">
        <strong>Create New Service</strong>
        <button class="pm-close" type="button" (click)="closeNewService()">√ó</button>
      </header>

      <!-- üü¢ Embed the Service Form Component -->
<app-service-form
  [projectId]="projectIdNum"
  (submitted)="onServiceCreated()"
  (cancelled)="closeNewService()">
</app-service-form>


    </div>
  </div>
</div>
